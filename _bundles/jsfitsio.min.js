!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("jsfitsio",[],t):"object"==typeof exports?exports.jsfitsio=t():e.jsfitsio=t()}(self,(()=>(()=>{var e,t,r={725:function(e,t,r){var n,i,o;o="undefined"!=typeof self&&self||"undefined"!=typeof window&&window||void 0!==r.g&&r.g||this,n=function(e){"use strict";var t=o.BlobBuilder||o.WebKitBlobBuilder||o.MSBlobBuilder||o.MozBlobBuilder,r=o.URL||o.webkitURL||function(e,t){return(t=document.createElement("a")).href=e,t},n=o.Blob,i=r.createObjectURL,s=r.revokeObjectURL,a=o.Symbol&&o.Symbol.toStringTag,l=!1,c=!1,u=t&&t.prototype.append&&t.prototype.getBlob;try{l=2===new Blob(["Ã¤"]).size,c=2===new Blob([new Uint8Array([1,2])]).size}catch(e){}function d(e){return e.map((function(e){if(e.buffer instanceof ArrayBuffer){var t=e.buffer;if(e.byteLength!==t.byteLength){var r=new Uint8Array(e.byteLength);r.set(new Uint8Array(t,e.byteOffset,e.byteLength)),t=r.buffer}return t}return e}))}function f(e,r){r=r||{};var n=new t;return d(e).forEach((function(e){n.append(e)})),r.type?n.getBlob(r.type):n.getBlob()}function h(e,t){return new n(d(e),t||{})}o.Blob&&(f.prototype=Blob.prototype,h.prototype=Blob.prototype);var p="function"==typeof TextEncoder?TextEncoder.prototype.encode.bind(new TextEncoder):function(e){for(var t=0,r=e.length,n=o.Uint8Array||Array,i=0,s=Math.max(32,r+(r>>1)+7),a=new n(s>>3<<3);t<r;){var l=e.charCodeAt(t++);if(l>=55296&&l<=56319){if(t<r){var c=e.charCodeAt(t);56320==(64512&c)&&(++t,l=((1023&l)<<10)+(1023&c)+65536)}if(l>=55296&&l<=56319)continue}if(i+4>a.length){s+=8,s=(s*=1+t/e.length*2)>>3<<3;var u=new Uint8Array(s);u.set(a),a=u}if(0!=(4294967168&l)){if(0==(4294965248&l))a[i++]=l>>6&31|192;else if(0==(4294901760&l))a[i++]=l>>12&15|224,a[i++]=l>>6&63|128;else{if(0!=(4292870144&l))continue;a[i++]=l>>18&7|240,a[i++]=l>>12&63|128,a[i++]=l>>6&63|128}a[i++]=63&l|128}else a[i++]=l}return a.slice(0,i)},y="function"==typeof TextDecoder?TextDecoder.prototype.decode.bind(new TextDecoder):function(e){for(var t=e.length,r=[],n=0;n<t;){var i,o,s,a,l=e[n],c=null,u=l>239?4:l>223?3:l>191?2:1;if(n+u<=t)switch(u){case 1:l<128&&(c=l);break;case 2:128==(192&(i=e[n+1]))&&(a=(31&l)<<6|63&i)>127&&(c=a);break;case 3:i=e[n+1],o=e[n+2],128==(192&i)&&128==(192&o)&&(a=(15&l)<<12|(63&i)<<6|63&o)>2047&&(a<55296||a>57343)&&(c=a);break;case 4:i=e[n+1],o=e[n+2],s=e[n+3],128==(192&i)&&128==(192&o)&&128==(192&s)&&(a=(15&l)<<18|(63&i)<<12|(63&o)<<6|63&s)>65535&&a<1114112&&(c=a)}null===c?(c=65533,u=1):c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|1023&c),r.push(c),n+=u}for(var d=r.length,f="",h=0;h<d;)f+=String.fromCharCode.apply(String,r.slice(h,h+=4096));return f};function b(){var t=!!o.ActiveXObject||"-ms-scroll-limit"in document.documentElement.style&&"-ms-ime-align"in document.documentElement.style,r=o.XMLHttpRequest&&o.XMLHttpRequest.prototype.send;t&&r&&(XMLHttpRequest.prototype.send=function(e){e instanceof Blob?(this.setRequestHeader("Content-Type",e.type),r.call(this,e)):r.call(this,e)});try{new File([],""),e.File=o.File,e.FileReader=o.FileReader}catch(t){try{e.File=new Function('class File extends Blob {constructor(chunks, name, opts) {opts = opts || {};super(chunks, opts || {});this.name = name.replace(/\\//g, ":");this.lastModifiedDate = opts.lastModified ? new Date(opts.lastModified) : new Date();this.lastModified = +this.lastModifiedDate;}};return new File([], ""), File')()}catch(t){e.File=function(e,t,r){var n=new Blob(e,r),i=r&&void 0!==r.lastModified?new Date(r.lastModified):new Date;return n.name=t.replace(/\//g,":"),n.lastModifiedDate=i,n.lastModified=+i,n.toString=function(){return"[object File]"},a&&(n[a]="File"),n}}}}l?(b(),e.Blob=c?o.Blob:h):u?(b(),e.Blob=f):function(){function t(e){for(var t=new Array(e.byteLength),r=new Uint8Array(e),n=t.length;n--;)t[n]=r[n];return t}function n(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r=[],n=0;n<e.length;n+=3){var i=e[n],o=n+1<e.length,s=o?e[n+1]:0,a=n+2<e.length,l=a?e[n+2]:0,c=i>>2,u=(3&i)<<4|s>>4,d=(15&s)<<2|l>>6,f=63&l;a||(f=64,o||(d=64)),r.push(t[c],t[u],t[d],t[f])}return r.join("")}var a=Object.create||function(e){function t(){}return t.prototype=e,new t};function l(e){return Object.prototype.toString.call(e).slice(8,-1)}function c(e,t){return"object"==typeof e&&Object.prototype.isPrototypeOf.call(e.prototype,t)}var u=["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","ArrayBuffer"];function d(e){return t=u,r=l(e),-1!==t.indexOf(r)||c(o.ArrayBuffer,e);var t,r}function f(e,r){r=null==r?{}:r;for(var n=0,i=(e=e?e.slice():[]).length;n<i;n++){var s=e[n];s instanceof f?e[n]=s._buffer:"string"==typeof s?e[n]=p(s):"DataView"===l(a=s)||c(o.DataView,a)?e[n]=t(s.buffer):d(s)?e[n]=t(s):e[n]=p(String(s))}var a;this._buffer=o.Uint8Array?function(e){for(var t=0,r=e.length;r--;)t+=e[r].length;for(var n=new Uint8Array(t),i=0,o=0;o<e.length;o++){var s=e[o];n.set(s,i),i+=s.byteLength||s.length}return n}(e):[].concat.apply([],e),this.size=this._buffer.length,this.type=r.type||"",/[^\u0020-\u007E]/.test(this.type)?this.type="":this.type=this.type.toLowerCase()}function h(e,t,r){r=r||{};var n=f.call(this,e,r)||this;return n.name=t.replace(/\//g,":"),n.lastModifiedDate=r.lastModified?new Date(r.lastModified):new Date,n.lastModified=+n.lastModifiedDate,n}if(f.prototype.arrayBuffer=function(){return Promise.resolve(this._buffer.buffer||this._buffer)},f.prototype.text=function(){return Promise.resolve(y(this._buffer))},f.prototype.slice=function(e,t,r){return new f([this._buffer.slice(e||0,t||this._buffer.length)],{type:r})},f.prototype.toString=function(){return"[object Blob]"},h.prototype=a(f.prototype),h.prototype.constructor=h,Object.setPrototypeOf)Object.setPrototypeOf(h,f);else try{h.__proto__=f}catch(e){}function b(){if(!(this instanceof b))throw new TypeError("Failed to construct 'FileReader': Please use the 'new' operator, this DOM object constructor cannot be called as a function.");var e=document.createDocumentFragment();this.addEventListener=e.addEventListener,this.dispatchEvent=function(t){var r=this["on"+t.type];"function"==typeof r&&r(t),e.dispatchEvent(t)},this.removeEventListener=e.removeEventListener}function v(e,t,r){if(!(t instanceof f))throw new TypeError("Failed to execute '"+r+"' on 'FileReader': parameter 1 is not of type 'Blob'.");e.result="",setTimeout((function(){this.readyState=b.LOADING,e.dispatchEvent(new Event("load")),e.dispatchEvent(new Event("loadend"))}))}h.prototype.toString=function(){return"[object File]"},b.EMPTY=0,b.LOADING=1,b.DONE=2,b.prototype.error=null,b.prototype.onabort=null,b.prototype.onerror=null,b.prototype.onload=null,b.prototype.onloadend=null,b.prototype.onloadstart=null,b.prototype.onprogress=null,b.prototype.readAsDataURL=function(e){v(this,e,"readAsDataURL"),this.result="data:"+e.type+";base64,"+n(e._buffer)},b.prototype.readAsText=function(e){v(this,e,"readAsText"),this.result=y(e._buffer)},b.prototype.readAsArrayBuffer=function(e){v(this,e,"readAsText"),this.result=(e._buffer.buffer||e._buffer).slice()},b.prototype.abort=function(){},r.createObjectURL=function(e){return e instanceof f?"data:"+e.type+";base64,"+n(e._buffer):i.call(r,e)},r.revokeObjectURL=function(e){s&&s.call(r,e)};var m=o.XMLHttpRequest&&o.XMLHttpRequest.prototype.send;m&&(XMLHttpRequest.prototype.send=function(e){e instanceof f?(this.setRequestHeader("Content-Type",e.type),m.call(this,y(e._buffer))):m.call(this,e)}),e.Blob=f,e.File=h,e.FileReader=b,e.URL=r}(),a&&(e.File.prototype[a]||(e.File.prototype[a]="File"),e.Blob.prototype[a]||(e.Blob.prototype[a]="Blob"),e.FileReader.prototype[a]||(e.FileReader.prototype[a]="FileReader"));var v,m=e.Blob.prototype;try{new ReadableStream({type:"bytes"}),v=function(){var e=0,t=this;return new ReadableStream({type:"bytes",autoAllocateChunkSize:524288,pull:function(r){var n=r.byobRequest.view;return t.slice(e,e+n.byteLength).arrayBuffer().then((function(i){var o=new Uint8Array(i),s=o.byteLength;e+=s,n.set(o),r.byobRequest.respond(s),e>=t.size&&r.close()}))}})}}catch(e){try{new ReadableStream({}),v=function(e){var t=0;return new ReadableStream({pull:function(r){return e.slice(t,t+524288).arrayBuffer().then((function(n){t+=n.byteLength;var i=new Uint8Array(n);r.enqueue(i),t==e.size&&r.close()}))}})}}catch(e){try{new Response("").body.getReader().read(),v=function(){return new Response(this).body}}catch(e){v=function(){throw new Error("Include https://github.com/MattiasBuelens/web-streams-polyfill")}}}}function A(e){return new Promise((function(t,r){e.onload=e.onerror=function(n){e.onload=e.onerror=null,"load"===n.type?t(e.result||e):r(new Error("Failed to read the blob/file"))}}))}m.arrayBuffer||(m.arrayBuffer=function(){var e=new FileReader;return e.readAsArrayBuffer(this),A(e)}),m.text||(m.text=function(){var e=new FileReader;return e.readAsText(this),A(e)}),m.stream||(m.stream=v)},void 0===(i=n.apply(t,[t]))||(e.exports=i)}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var o=n[e]={exports:{}};return r[e].call(o.exports,o,o.exports,i),o.exports}i.m=r,i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,r)=>(i.f[r](e,t),t)),[])),i.u=e=>e+".bundle.js?h="+{437:"0097536bf1b322cc2ab1",662:"215269815ed9e9913038"}[e],i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="jsfitsio:",i.l=(r,n,o,s)=>{if(e[r])e[r].push(n);else{var a,l;if(void 0!==o)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==t+o){a=d;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,i.nc&&a.setAttribute("nonce",i.nc),a.setAttribute("data-webpack",t+o),a.src=r),e[r]=[n];var f=(t,n)=>{a.onerror=a.onload=null,clearTimeout(h);var i=e[r];if(delete e[r],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((e=>e(n))),t)return t(n)},h=setTimeout(f.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=f.bind(null,a.onerror),a.onload=f.bind(null,a.onload),l&&document.head.appendChild(a)}},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})(),(()=>{var e={569:0,577:0};i.f.j=(t,r)=>{var n=i.o(e,t)?e[t]:void 0;if(0!==n)if(n)r.push(n[2]);else{var o=new Promise(((r,i)=>n=e[t]=[r,i]));r.push(n[2]=o);var s=i.p+i.u(t),a=new Error;i.l(s,(r=>{if(i.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var o=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.src;a.message="Loading chunk "+t+" failed.\n("+o+": "+s+")",a.name="ChunkLoadError",a.type=o,a.request=s,n[1](a)}}),"chunk-"+t,t)}};var t=(t,r)=>{var n,o,[s,a,l]=r,c=0;if(s.some((t=>0!==e[t]))){for(n in a)i.o(a,n)&&(i.m[n]=a[n]);l&&l(i)}for(t&&t(r);c<s.length;c++)o=s[c],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0},r=self.webpackChunkjsfitsio=self.webpackChunkjsfitsio||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var o={};return(()=>{"use strict";i.r(o),i.d(o,{FITSHeader:()=>t,FITSHeaderItem:()=>e,FITSParser:()=>u,FITSWriter:()=>s,ParseHeader:()=>l,ParsePayload:()=>a,ParseUtils:()=>n});class e{constructor(e,t,r){this._key=void 0!==e?e:void 0,this._value=void 0!==t?t:void 0,this._comment=void 0!==r?r:void 0}get key(){return this._key}get comment(){return this._comment}get value(){return this._value}}class t extends Map{constructor(){super(),this._offset=void 0,this._items=[]}set offset(e){this._offset=e}get offset(){return this._offset}getItemList(){return this._items}getItemListOf(e){const t=[];for(let r=0;r<this._items.length;r++){const n=this._items[r];n.key==e&&t.push(n)}return t}addItemAtTheBeginning(e){void 0!==e.key&&["SIMPLE","BITPIX","NAXIS","NAXIS1","NAXIS2","BLANK","BZERO","BSCALE","DATAMIN","DATAMAX","NPIX","ORDER","CRPIX1","CRPIX2","CDELT1","CDELT2","CRVAL1","CRVAL2"].includes(e.key)&&this.set(e.key,e.value);const t=[e].concat(this._items);this._items=t}addItem(e){void 0!==e.key&&["SIMPLE","BITPIX","NAXIS","NAXIS1","NAXIS2","BLANK","BZERO","BSCALE","DATAMIN","DATAMAX","NPIX","ORDER","CRPIX1","CRPIX2","CDELT1","CDELT2","CRVAL1","CRVAL2"].includes(e.key)&&this.set(e.key,e.value),this._items.push(e)}getNumRows(){return this._items.length}}var r=i(725);class n{static getStringAt(e,t,r){const n=[];for(let i=t,o=0;i<t+r;i++,o++)n[o]=String.fromCharCode(255&e.charCodeAt(i));return n.join("")}static byteString(e){if(e<0||e>255||e%1!=0)throw new Error(e+" does not fit in a byte");return("000000000"+e.toString(2)).substr(-8)}static parse32bitSinglePrecisionFloatingPoint(e,t,r,n){let i=(((e<<8)+t<<8)+r<<8)+n;return i<0&&(i+=4294967296),(1+(8388607&i)/8388608)*Math.pow(2,((2139095040&i)>>23)-127)}static convertBlankToBytes(e,t){let r=Math.abs(e).toString(2);for(;r.length/8<t;)r+="0";const n=new ArrayBuffer(t),i=new Uint8Array(n);for(let e=0;e<t;e++)i[e]=parseInt(r.substr(8*e,8*(e+1)),2);return i}static parseFloatingPointFormat(e,t,r){const n=[];for(let t=e.length;t;t-=1){let r=e[t-1];for(let e=8;e;e-=1)n.push(r%2?1:0),r>>=1}n.reverse();const i=n.join(""),o=(1<<t-1)-1,s=parseInt(i.substring(0,1),2)?-1:1,a=parseInt(i.substring(1,1+t),2),l=parseInt(i.substring(1+t),2);return a===(1<<t)-1?0!==l?void 0:s*(1/0):a>0?s*Math.pow(2,a-o)*(1+l/Math.pow(2,r)):0!==l?s*Math.pow(2,-(o-1))*(l/Math.pow(2,r)):0*s}static generate16bit2sComplement(e){throw new TypeError("not implemented yet"+e)}static parse16bit2sComplement(e,t){const r=e<<8|t;return 32768&r?4294901760|r:r}static parse32bit2sComplement(e,t,r,n){const i=e<<24|t<<16|r<<8|n;let o=4294967295&i;return(2147483648&i)>>31?(o=1+(4294967295&~i),-1*o):o}static getByteAt(e,t){return 255&e.charCodeAt(t+0)}static extractPixelValue(e,t,r){let i;if(8==r)i=t[0];else if(16==r)i=n.parse16bit2sComplement(t[e],t[e+1]);else if(32==r)i=n.parse32bit2sComplement(t[e],t[e+1],t[e+2],t[e+3]);else if(-32==r)i=n.parseFloatingPointFormat(t.slice(e,e+8),8,23);else{if(64==r)throw new Error("BITPIX=64 -> 64-bit 2's complement binary integer NOT supported yet.");-64==r&&(i=n.parseFloatingPointFormat(t.slice(e,e+8),11,52))}return i}}class s{constructor(){this._headerArray=new Uint8Array,this._payloadArray=new Array,this._fitsData=new Uint8Array}run(e,t){this.prepareHeader(e),this._payloadArray=t,this.prepareFITS()}prepareHeader(t){const r=new e("END");t.addItem(r);let i="";for(let e=0;e<t.getItemList().length;e++){const r=t.getItemList()[e];let n=this.formatHeaderLine(r);void 0!==n&&(i+=n)}const o=(new TextEncoder).encode(i).length,s=2880*Math.ceil(o/2880);for(let e=0;e<s-o;e++)i+=" ";const a=new ArrayBuffer(i.length);this._headerArray=new Uint8Array(a);for(let e=0;e<i.length;e++)this._headerArray[e]=n.getByteAt(i,e)}formatHeaderLine(e){let t,r=e.key,n=e.value,i=e.comment;if(null!=r){if(t=r,"END"==r){for(let e=80;e>r.length;e--)t+=" ";return t}if("COMMENT"==r||"HISTORY"==r){for(let e=0;e<10-r.length;e++)t+=" ";t+=n;const e=t.length;for(let r=80;r>e;r--)t+=" ";return t}for(let e=0;e<8-r.length;e++)t+=" ";if(t+="= ",null!=n){t+=n,null!=i&&(t+=i);const e=t.length;for(let r=80;r>e;r--)t+=" "}else{null!=i&&(t+=i);const e=t.length;for(let r=80;r>e;r--)t+=" "}}else{t="";for(let e=0;e<18;e++)t+=" ";if(null!=i){t+=i;const e=t.length;for(let r=80;r>e;r--)t+=" "}else{t="";for(let e=80;e>0;e--)t+=" "}}return t}prepareFITS(){const e=new Uint8Array(this._headerArray.length+this._payloadArray[0].length*this._payloadArray.length);e.set(this._headerArray,0);for(let t=0;t<this._payloadArray.length;t++){const r=this._payloadArray[t];e.set(r,this._headerArray.length+t*r.length)}this._fitsData=e}typedArrayToURL(){const e=new r.Blob([this._fitsData],{type:"application/fits"});return URL.createObjectURL(e)}}class a{constructor(e,t){this._u8data=new Uint8Array,this._BZERO=void 0,this._BSCALE=void 0,this._BLANK=void 0,this._BITPIX=void 0,this._NAXIS1=void 0,this._NAXIS2=void 0,this._DATAMIN=void 0,this._DATAMAX=void 0,this._physicalblank=void 0;const r=t.slice(e.offset);this._u8data=new Uint8Array(r),this.init(e)}init(t){if(this._BZERO=t.get("BZERO"),void 0===this._BZERO&&(this._BZERO=0),this._BSCALE=t.get("BSCALE"),void 0===this._BSCALE&&(this._BSCALE=1),this._BLANK=t.get("BLANK"),this._BITPIX=t.get("BITPIX"),this._NAXIS1=t.get("NAXIS1"),this._NAXIS2=t.get("NAXIS2"),this._DATAMIN=t.get("DATAMIN"),this._DATAMAX=t.get("DATAMAX"),this._physicalblank=void 0,void 0===this._DATAMAX||void 0===this._DATAMIN){const[r,n]=this.computePhysicalMinAndMax();this._DATAMAX=n,this._DATAMIN=r;const i=new e("DATAMAX",n," / computed with FITSParser"),o=new e("DATAMIN",r," / computed with FITSParser");t.addItem(i),t.addItem(o)}}computePhysicalMinAndMax(){let e=0;if(void 0===this._BITPIX)throw new Error("BITPIX is not defined");const t=Math.abs(this._BITPIX/8),r=this._u8data.byteLength/t;let n,i,o,s;for(void 0!==this._BLANK&&(this._physicalblank=this.pixel2physicalValue(this._BLANK));e<r;)n=this.extractPixelValue(t*e),void 0!==n?(i=this.pixel2physicalValue(n),void 0===o&&(o=i),void 0===s&&(s=i),void 0!==this._physicalblank&&this._physicalblank===i||(void 0!==i&&(i<o||void 0===o)&&(o=i),void 0!==i&&(i>s||void 0===s)&&(s=i)),e++):e++;return[o,s]}parse(){if(void 0===this._BITPIX)throw new Error("BITPIX is undefined");if(void 0===this._NAXIS1)throw new Error("NAXIS1 is undefined");if(void 0===this._NAXIS2)throw new Error("NAXIS2 is undefined");const e=Math.abs(this._BITPIX/8);let t=this._u8data.byteLength/e;t=this._NAXIS1*this._NAXIS2;let r,n,i=0;const o=[];for(;i<t;){n=Math.floor(i/this._NAXIS1),r=(i-n*this._NAXIS1)*e,0===r&&(o[n]=new Uint8Array(this._NAXIS1*e));for(let t=0;t<e;t++)o[n][r+t]=this._u8data[i*e+t];i++}return o}extractPixelValue(e){let t;if(16==this._BITPIX)t=n.parse16bit2sComplement(this._u8data[e],this._u8data[e+1]);else if(32==this._BITPIX)t=n.parse32bit2sComplement(this._u8data[e],this._u8data[e+1],this._u8data[e+2],this._u8data[e+3]);else if(-32==this._BITPIX)t=n.parseFloatingPointFormat(this._u8data.slice(e,e+4),8,23);else{if(64==this._BITPIX)throw new Error("BITPIX=64 -> 64-bit 2's complement binary integer NOT supported yet.");-64==this._BITPIX&&(t=n.parseFloatingPointFormat(this._u8data.slice(e,e+8),11,52))}return t}pixel2physicalValue(e){if(void 0===this._BZERO||void 0===this._BSCALE)throw new Error("Either BZERO or BSCALE is undefined");return this._BZERO+this._BSCALE*e}}class l{static parse(r){const n=new TextDecoder("iso-8859-1"),i=new t;let o,s,a,c,u,d,f,h=0,p="";for(d=null;"END"!==p&&r.length>0;){if(s=new Uint8Array(r.slice(80*h,80*h+80)),h++,a=new Uint8Array(s.slice(0,8)),p=n.decode(a).trim(),u=new Uint8Array(s.slice(8,10)),c=new Uint8Array(s.slice(10,80)),o=n.decode(c).trim(),61==u[0]&&32==u[1]){let t=32;for(let e=0;e<c.length;e++)if(32!=c[e]){t=c[e];break}39!=t&&Number(o)?84==t||70==t?f=l.parseLogicalValue(c):(o=n.decode(c).trim(),f=o.includes(".")?l.parseFloatValue(c):l.parseIntValue(c)):f=l.parseLogicalValue(c),d=new e(p,f.val,f.comment)}else if("COMMENT"==p||"HISTORY"==p)d=new e(p,void 0,o);else{let t=32;for(let e=0;e<c.length;e++)if(32!=c[e]){t=c[e];break}47==t?d=new e(void 0,void 0,o):32==t&&(d=new e(void 0,void 0,void 0))}null!=d&&i.addItem(d)}d=new e("COMMENT","FITS generated with FITSParser on ",void 0),i.addItem(d);const y=new Date;d=new e("COMMENT",y.toString()),i.addItem(d);const b=2880*Math.ceil(h/36);return i.offset=b,i}static parseStringValue(e){const t=new TextDecoder("iso-8859-1").decode(e).trim(),r=t.lastIndexOf("/");return{val:t.substring(0,r),comment:t.substring(r)}}static parseLogicalValue(e){const t=new TextDecoder("iso-8859-1").decode(e).trim().split("/");return void 0===t[1]?{val:t[0].trim(),comment:void 0}:{val:t[0].trim(),comment:" /"+t[1]}}static parseIntValue(e){const t=new TextDecoder("iso-8859-1").decode(e).trim().split("/");return void 0===t[1]?{val:parseInt(t[0].trim()),comment:void 0}:{val:parseInt(t[0].trim()),comment:" /"+t[1]}}static parseFloatValue(e){const t=new TextDecoder("iso-8859-1").decode(e).trim().split("/");return void 0===t[1]?{val:parseFloat(t[0].trim()),comment:void 0}:{val:parseFloat(t[0].trim()),comment:" /"+t[1]}}}var c=function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}l((n=n.apply(e,t||[])).next())}))};class u{constructor(e){this._url=e}loadFITS(){return c(this,void 0,void 0,(function*(){return this.getFile(this._url).then((e=>{if(null!==e&&e.byteLength>0){const t=new Uint8Array(e);return this.processFits(t)}return null})).catch((e=>{var t,r;if(null===(r=null===(t=null==e?void 0:e.response)||void 0===t?void 0:t.data)||void 0===r?void 0:r.message)throw new Error("[FITSParser->loadFITS] "+e.response.data.message);throw e}))}))}processFits(e){const t=l.parse(e);return{header:t,data:new a(t,e).parse()}}static generateFITS(e,t){const r=new s;return r.run(e,t),r.typedArrayToURL()}getFile(e){return c(this,void 0,void 0,(function*(){if(e.substring(0,5).toLowerCase().includes("http"))return(yield i.e(437).then(i.bind(i,437))).getFile(e).then((e=>e)).catch((e=>null));{let t=yield i.e(662).then(i.bind(i,662));return yield t.getLocalFile(e)}}))}}})(),o})()));
//# sourceMappingURL=jsfitsio.min.js.map