!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("jsfitsio",[],t):"object"==typeof exports?exports.jsfitsio=t():e.jsfitsio=t()}(self,(()=>(()=>{var e,t,r={603:()=>{}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var s=n[e]={exports:{}};return r[e].call(s.exports,s,s.exports,i),s.exports}i.m=r,i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,r)=>(i.f[r](e,t),t)),[])),i.u=e=>e+".bundle.js?h="+{483:"52fb69092e45eb7d84c7",646:"01a5dcdb2c8c510a2589"}[e],i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="jsfitsio:",i.l=(r,n,s,o)=>{if(e[r])e[r].push(n);else{var l,a;if(void 0!==s)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==t+s){l=d;break}}l||(a=!0,(l=document.createElement("script")).charset="utf-8",l.timeout=120,i.nc&&l.setAttribute("nonce",i.nc),l.setAttribute("data-webpack",t+s),l.src=r),e[r]=[n];var p=(t,n)=>{l.onerror=l.onload=null,clearTimeout(f);var i=e[r];if(delete e[r],l.parentNode&&l.parentNode.removeChild(l),i&&i.forEach((e=>e(n))),t)return t(n)},f=setTimeout(p.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=p.bind(null,l.onerror),l.onload=p.bind(null,l.onload),a&&document.head.appendChild(l)}},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=r[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})(),(()=>{var e={202:0,924:0};i.f.j=(t,r)=>{var n=i.o(e,t)?e[t]:void 0;if(0!==n)if(n)r.push(n[2]);else{var s=new Promise(((r,i)=>n=e[t]=[r,i]));r.push(n[2]=s);var o=i.p+i.u(t),l=new Error;i.l(o,(r=>{if(i.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var s=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;l.message="Loading chunk "+t+" failed.\n("+s+": "+o+")",l.name="ChunkLoadError",l.type=s,l.request=o,n[1](l)}}),"chunk-"+t,t)}};var t=(t,r)=>{var n,s,[o,l,a]=r,c=0;if(o.some((t=>0!==e[t]))){for(n in l)i.o(l,n)&&(i.m[n]=l[n]);a&&a(i)}for(t&&t(r);c<o.length;c++)s=o[c],i.o(e,s)&&e[s]&&e[s][0](),e[s]=0},r=self.webpackChunkjsfitsio=self.webpackChunkjsfitsio||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var s={};return(()=>{"use strict";i.r(s),i.d(s,{FITSHeaderItem:()=>e,FITSHeaderManager:()=>t,FITSParser:()=>u,FITSWriter:()=>n,ParseHeader:()=>o,ParsePayload:()=>a,ParseUtils:()=>l});class e{constructor(e,t,r){this._key="",this._value="",this._comment="",this._key=e,this._value=t,this._comment=r}get key(){return this._key}get comment(){return this._comment}get value(){return this._value}}class t{constructor(){this.items=[],this.items[0]=new e(t.SIMPLE,"T",""),this.items[1]=new e(t.BITPIX,"",""),this.items[2]=new e(t.NAXIS,2,""),this.items[3]=new e(t.NAXIS1,"",""),this.items[4]=new e(t.NAXIS2,"","")}insert(e){e.key===t.SIMPLE?this.items[0]=e:e.key===t.BITPIX?this.items[1]=e:e.key===t.NAXIS?this.items[2]=e:e.key===t.NAXIS1?this.items[3]=e:e.key===t.NAXIS2?this.items[4]=e:this.items.push(e)}getItems(){return this.items}remove(e){this.items=this.items.filter((t=>t.key!==e))}findById(e){return this.items.find((t=>t.key===e))||null}}t.SIMPLE="SIMPLE",t.BITPIX="BITPIX",t.BZERO="BZERO",t.BSCALE="BSCALE",t.BLANK="BLANK",t.NAXIS="NAXIS",t.NAXIS1="NAXIS1",t.NAXIS2="NAXIS2",t.DATAMIN="DATAMIN",t.DATAMAX="DATAMAX",t.CRVAL1="CRVAL1",t.CRVAL2="CRVAL2",t.CTYPE1="CTYPE1",t.CTYPE2="CTYPE2",t.CRPIX1="CRPIX1",t.CRPIX2="CRPIX2",t.ORIGIN="ORIGIN",t.COMMENT="COMMENT";var r=i(603);class n{static createFITS(e){const t=this.createHeader(e.header),r=this.createData(e.data),n=new Uint8Array(t.length+r.length);return n.set(t,0),n.set(r,t.length),n}static createHeader(e){let t="";for(const r of e.getItems())"END"!==r.key&&(t+=`${r.key?r.key.padEnd(8," "):"        "}${void 0!==r.value?`= ${r.value}`:""}${r.comment?` / ${r.comment}`:""}`.padEnd(80," "));for(t+="END".padEnd(80," ");t.length%2880!=0;)t+=" ";return(new TextEncoder).encode(t)}static createData(e){let t=e.reduce(((e,t)=>e+t.length),0);return new Uint8Array(t)}static typedArrayToURL(e){const t=this.createFITS(e),r=new Blob([t],{type:"application/fits"}),n=URL.createObjectURL(r);return console.log(`Generated FITS file URL: ${n}`),setTimeout((()=>n),1e4),console.log(`Generated FITS will be available for 10 seconds: ${n}`),n}static writeFITSFile(e,t){const n=this.createFITS(e);try{r.writeFileSync(t,n),console.log(`FITS file written successfully to: ${t}`)}catch(e){console.error(`Error writing FITS file: ${e}`)}}}class o{static getFITSItemValue(e,t){const r=e.findById(t);let n=null;return r&&(n=Number(r.value)),n}static parse(r){const n=new TextDecoder("ascii").decode(r.slice(0,2880)),i=new t,s=n.match(/.{1,80}/g)||[];for(const t of s){const r=t.slice(0,8).trim();let n,s="";if(r&&"END"!==r){const o=t.slice(10).trim().split("/")[0].trim();n=isNaN(Number(o))?o:Number(o),t.includes("/")&&(s=t.slice(10).trim().split("/")[1].trim());const l=new e(r,n,s);i.insert(l)}}return i}}class l{static getStringAt(e,t,r){const n=[];for(let i=t,s=0;i<t+r;i++,s++)n[s]=String.fromCharCode(255&e.charCodeAt(i));return n.join("")}static byteString(e){if(e<0||e>255||e%1!=0)throw new Error(e+" does not fit in a byte");return("000000000"+e.toString(2)).substr(-8)}static parse32bitSinglePrecisionFloatingPoint(e,t,r,n){let i=(((e<<8)+t<<8)+r<<8)+n;return i<0&&(i+=4294967296),(1+(8388607&i)/8388608)*Math.pow(2,((2139095040&i)>>23)-127)}static convertBlankToBytes(e,t){let r=Math.abs(e).toString(2);for(;r.length/8<t;)r+="0";const n=new ArrayBuffer(t),i=new Uint8Array(n);for(let e=0;e<t;e++)i[e]=parseInt(r.substr(8*e,8*(e+1)),2);return i}static parseFloatingPointFormat(e,t,r){const n=[];for(let t=e.length;t;t-=1){let r=e[t-1];for(let e=8;e;e-=1)n.push(r%2?1:0),r>>=1}n.reverse();const i=n.join(""),s=(1<<t-1)-1,o=parseInt(i.substring(0,1),2)?-1:1,l=parseInt(i.substring(1,1+t),2),a=parseInt(i.substring(1+t),2);return l===(1<<t)-1?0!==a?null:o*(1/0):l>0?o*Math.pow(2,l-s)*(1+a/Math.pow(2,r)):0!==a?o*Math.pow(2,-(s-1))*(a/Math.pow(2,r)):0*o}static generate16bit2sComplement(e){throw new TypeError("not implemented yet"+e)}static parse16bit2sComplement(e,t){const r=e<<8|t;return 32768&r?4294901760|r:r}static parse32bit2sComplement(e,t,r,n){const i=e<<24|t<<16|r<<8|n;let s=4294967295&i;return(2147483648&i)>>31?(s=1+(4294967295&~i),-1*s):s}static getByteAt(e,t){return 255&e.charCodeAt(t+0)}static extractPixelValue(e,t,r){let n=null;if(8==r)n=t[0];else if(16==r)n=l.parse16bit2sComplement(t[e],t[e+1]);else if(32==r)n=l.parse32bit2sComplement(t[e],t[e+1],t[e+2],t[e+3]);else if(-32==r)n=l.parseFloatingPointFormat(t.slice(e,e+8),8,23);else{if(64==r)throw new Error("BITPIX=64 -> 64-bit 2's complement binary integer NOT supported yet.");-64==r&&(n=l.parseFloatingPointFormat(t.slice(e,e+8),11,52))}return n}}class a{static computePhysicalMinAndMax(r,n){const i=o.getFITSItemValue(r,t.BITPIX);if(null===i)return null;const s=o.getFITSItemValue(r,t.NAXIS1);if(null===s)return null;const l=o.getFITSItemValue(r,t.NAXIS2);if(null===l)return null;const c=o.getFITSItemValue(r,t.DATAMIN),u=o.getFITSItemValue(r,t.DATAMAX);if(!i||!s||!l)return null;if(!u||!c){const[t,i]=a.computePhysicalValues(n,r);if(t&&i){const n=new e("DATAMAX",t,"computed by jsfitsio"),s=new e("DATAMIN",i,"computed by jsfitsio");r.insert(n),r.insert(s)}}const d=new e("END","","");return r.insert(d),r}static computePhysicalValues(e,r){const n=o.getFITSItemValue(r,t.BITPIX);if(null===n||isNaN(n))return[null,null];const i=o.getFITSItemValue(r,t.BLANK);if(null===i||isNaN(n))return[null,null];let s=o.getFITSItemValue(r,t.BZERO);null===s&&(s=0);let l=o.getFITSItemValue(r,t.BSCALE);null===l&&(l=1);let c=0;const u=Math.abs(n/8),d=e.byteLength/u;let p=null,f=null,m=null;for(i&&(m=a.pixel2physicalValue(i,l,s));c<d;){let t=a.extractPixelValue(e,u*c,n);if(null===t){c++;continue}let r=a.pixel2physicalValue(t,l,s);p||(p=r),f||(f=r),null!==m&&m===r||(null!==r&&(r<p||null===p)&&(p=r),null!==r&&(r>f||null===f)&&(f=r)),c++}return[p,f]}static pixel2physicalValue(e,t,r){if(null===r||null===t)throw new Error("Either BZERO or BSCALE is null");return r+t*e}static extractPixelValue(e,t,r){let n=null;if(16==r)n=l.parse16bit2sComplement(e[t],e[t+1]);else if(32==r)n=l.parse32bit2sComplement(e[t],e[t+1],e[t+2],e[t+3]);else if(-32==r)n=l.parseFloatingPointFormat(e.slice(t,t+4),8,23);else{if(64==r)throw new Error("BITPIX=64 -> 64-bit 2's complement binary integer NOT supported yet.");-64==r&&(n=l.parseFloatingPointFormat(e.slice(t,t+8),11,52))}return n}}var c=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{a(n.next(e))}catch(e){s(e)}}function l(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,l)}a((n=n.apply(e,t||[])).next())}))};class u{static loadFITS(e){return c(this,void 0,void 0,(function*(){const t=yield u.getFile(e);return(null==t?void 0:t.byteLength)?u.processFits(t):null}))}static processFits(e){const t=o.parse(e),r=a.computePhysicalMinAndMax(t,e);if(null==r)return null;const n=new Uint8Array(e.slice(2880));return{header:r,data:u.createMatrix(n,t)}}static createMatrix(e,r){const n=o.getFITSItemValue(r,t.NAXIS1);if(null===n)throw new Error("NAXIS1 not defined.");const i=o.getFITSItemValue(r,t.NAXIS2);if(null===i)throw new Error("NAXIS2 not defined.");const s=o.getFITSItemValue(r,t.BITPIX);if(null===s)throw new Error("BITPIX not defined.");const l=Math.abs(s/8);if(e.length!==n*i*l)throw new Error("Payload size does not match the expected matrix dimensions.");const a=[];for(let t=0;t<i;t++)a.push(e.slice(t*n*l,(t+1)*n*l));return a}static generateFITSForWeb(e){return n.typedArrayToURL(e)}static saveFITSLocally(e,t){return n.writeFITSFile(e,t)}static getFile(e){return c(this,void 0,void 0,(function*(){if(e.substring(0,5).toLowerCase().includes("http")){const t=yield i.e(646).then(i.bind(i,646)),r=yield t.getFile(e);return(null==r?void 0:r.byteLength)?new Uint8Array(r):new Uint8Array(0)}{const t=yield i.e(483).then(i.bind(i,483)),r=yield t.getLocalFile(e);return(null==r?void 0:r.length)?new Uint8Array(r):new Uint8Array(0)}}))}}})(),s})()));
//# sourceMappingURL=jsfitsio.js.map