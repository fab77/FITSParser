var FITSioAPI;(()=>{var e={300:(e,t)=>{"use strict";var r=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r)return r;throw new Error("unable to locate global object")}();e.exports=t=r.fetch,r.fetch&&(t.default=r.fetch.bind(r)),t.Headers=r.Headers,t.Request=r.Request,t.Response=r.Response},520:(e,t,r)=>{"use strict";var n=r(155),i="win32"===n.platform,o=r(539);function s(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n];i&&"."!==i&&(".."===i?r.length&&".."!==r[r.length-1]?r.pop():t&&r.push(".."):r.push(i))}return r}function a(e){for(var t=e.length-1,r=0;r<=t&&!e[r];r++);for(var n=t;n>=0&&!e[n];n--);return 0===r&&n===t?e:r>n?[]:e.slice(r,n+1)}var l=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,u=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/,c={};function f(e){var t=l.exec(e),r=(t[1]||"")+(t[2]||""),n=t[3]||"",i=u.exec(n);return[r,i[1],i[2],i[3]]}function p(e){var t=l.exec(e),r=t[1]||"",n=!!r&&":"!==r[1];return{device:r,isUnc:n,isAbsolute:n||!!t[2],tail:t[3]}}function h(e){return"\\\\"+e.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\")}c.resolve=function(){for(var e="",t="",r=!1,i=arguments.length-1;i>=-1;i--){var a;if(i>=0?a=arguments[i]:e?(a=n.env["="+e])&&a.substr(0,3).toLowerCase()===e.toLowerCase()+"\\"||(a=e+"\\"):a=n.cwd(),!o.isString(a))throw new TypeError("Arguments to path.resolve must be strings");if(a){var l=p(a),u=l.device,c=l.isUnc,f=l.isAbsolute,d=l.tail;if((!u||!e||u.toLowerCase()===e.toLowerCase())&&(e||(e=u),r||(t=d+"\\"+t,r=f),e&&r))break}}return c&&(e=h(e)),e+(r?"\\":"")+(t=s(t.split(/[\\\/]+/),!r).join("\\"))||"."},c.normalize=function(e){var t=p(e),r=t.device,n=t.isUnc,i=t.isAbsolute,o=t.tail,a=/[\\\/]$/.test(o);return(o=s(o.split(/[\\\/]+/),!i).join("\\"))||i||(o="."),o&&a&&(o+="\\"),n&&(r=h(r)),r+(i?"\\":"")+o},c.isAbsolute=function(e){return p(e).isAbsolute},c.join=function(){for(var e=[],t=0;t<arguments.length;t++){var r=arguments[t];if(!o.isString(r))throw new TypeError("Arguments to path.join must be strings");r&&e.push(r)}var n=e.join("\\");return/^[\\\/]{2}[^\\\/]/.test(e[0])||(n=n.replace(/^[\\\/]{2,}/,"\\")),c.normalize(n)},c.relative=function(e,t){e=c.resolve(e),t=c.resolve(t);for(var r=e.toLowerCase(),n=t.toLowerCase(),i=a(t.split("\\")),o=a(r.split("\\")),s=a(n.split("\\")),l=Math.min(o.length,s.length),u=l,f=0;f<l;f++)if(o[f]!==s[f]){u=f;break}if(0==u)return t;var p=[];for(f=u;f<o.length;f++)p.push("..");return(p=p.concat(i.slice(u))).join("\\")},c._makeLong=function(e){if(!o.isString(e))return e;if(!e)return"";var t=c.resolve(e);return/^[a-zA-Z]\:\\/.test(t)?"\\\\?\\"+t:/^\\\\[^?.]/.test(t)?"\\\\?\\UNC\\"+t.substring(2):e},c.dirname=function(e){var t=f(e),r=t[0],n=t[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},c.basename=function(e,t){var r=f(e)[2];return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r},c.extname=function(e){return f(e)[3]},c.format=function(e){if(!o.isObject(e))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof e);var t=e.root||"";if(!o.isString(t))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof e.root);var r=e.dir,n=e.base||"";return r?r[r.length-1]===c.sep?r+n:r+c.sep+n:n},c.parse=function(e){if(!o.isString(e))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof e);var t=f(e);if(!t||4!==t.length)throw new TypeError("Invalid path '"+e+"'");return{root:t[0],dir:t[0]+t[1].slice(0,-1),base:t[2],ext:t[3],name:t[2].slice(0,t[2].length-t[3].length)}},c.sep="\\",c.delimiter=";";var d=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,g={};function m(e){return d.exec(e).slice(1)}g.resolve=function(){for(var e="",t=!1,r=arguments.length-1;r>=-1&&!t;r--){var i=r>=0?arguments[r]:n.cwd();if(!o.isString(i))throw new TypeError("Arguments to path.resolve must be strings");i&&(e=i+"/"+e,t="/"===i[0])}return(t?"/":"")+(e=s(e.split("/"),!t).join("/"))||"."},g.normalize=function(e){var t=g.isAbsolute(e),r=e&&"/"===e[e.length-1];return(e=s(e.split("/"),!t).join("/"))||t||(e="."),e&&r&&(e+="/"),(t?"/":"")+e},g.isAbsolute=function(e){return"/"===e.charAt(0)},g.join=function(){for(var e="",t=0;t<arguments.length;t++){var r=arguments[t];if(!o.isString(r))throw new TypeError("Arguments to path.join must be strings");r&&(e+=e?"/"+r:r)}return g.normalize(e)},g.relative=function(e,t){e=g.resolve(e).substr(1),t=g.resolve(t).substr(1);for(var r=a(e.split("/")),n=a(t.split("/")),i=Math.min(r.length,n.length),o=i,s=0;s<i;s++)if(r[s]!==n[s]){o=s;break}var l=[];for(s=o;s<r.length;s++)l.push("..");return(l=l.concat(n.slice(o))).join("/")},g._makeLong=function(e){return e},g.dirname=function(e){var t=m(e),r=t[0],n=t[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},g.basename=function(e,t){var r=m(e)[2];return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r},g.extname=function(e){return m(e)[3]},g.format=function(e){if(!o.isObject(e))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof e);var t=e.root||"";if(!o.isString(t))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof e.root);return(e.dir?e.dir+g.sep:"")+(e.base||"")},g.parse=function(e){if(!o.isString(e))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof e);var t=m(e);if(!t||4!==t.length)throw new TypeError("Invalid path '"+e+"'");return t[1]=t[1]||"",t[2]=t[2]||"",t[3]=t[3]||"",{root:t[0],dir:t[0]+t[1].slice(0,-1),base:t[2],ext:t[3],name:t[2].slice(0,t[2].length-t[3].length)}},g.sep="/",g.delimiter=":",e.exports=i?c:g,e.exports.posix=g,e.exports.win32=c},155:e=>{var t,r,n=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var a,l=[],u=!1,c=-1;function f(){u&&a&&(u=!1,a.length?l=a.concat(l):c=-1,l.length&&p())}function p(){if(!u){var e=s(f);u=!0;for(var t=l.length;t;){for(a=l,l=[];++c<t;)a&&a[c].run();c=-1,t=l.length}a=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function d(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new h(e,t)),1!==l.length||u||s(p)},h.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=d,n.addListener=d,n.once=d,n.off=d,n.removeListener=d,n.removeAllListeners=d,n.emit=d,n.prependListener=d,n.prependOnceListener=d,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},496:e=>{"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},384:e=>{e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},539:(e,t,r)=>{var n=r(155),i=/%[sdj%]/g;t.format=function(e){if(!y(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(a(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,o=n.length,s=String(e).replace(i,(function(e){if("%%"===e)return"%";if(r>=o)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}})),l=n[r];r<o;l=n[++r])g(l)||!b(l)?s+=" "+l:s+=" "+a(l);return s},t.deprecate=function(e,i){if(v(r.g.process))return function(){return t.deprecate(e,i).apply(this,arguments)};if(!0===n.noDeprecation)return e;var o=!1;return function(){if(!o){if(n.throwDeprecation)throw new Error(i);n.traceDeprecation?console.trace(i):console.error(i),o=!0}return e.apply(this,arguments)}};var o,s={};function a(e,r){var n={seen:[],stylize:u};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),d(r)?n.showHidden=r:r&&t._extend(n,r),v(n.showHidden)&&(n.showHidden=!1),v(n.depth)&&(n.depth=2),v(n.colors)&&(n.colors=!1),v(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=l),c(n,e,n.depth)}function l(e,t){var r=a.styles[t];return r?"["+a.colors[r][0]+"m"+e+"["+a.colors[r][1]+"m":e}function u(e,t){return e}function c(e,r,n){if(e.customInspect&&r&&I(r.inspect)&&r.inspect!==t.inspect&&(!r.constructor||r.constructor.prototype!==r)){var i=r.inspect(n,e);return y(i)||(i=c(e,i,n)),i}var o=function(e,t){if(v(t))return e.stylize("undefined","undefined");if(y(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return m(t)?e.stylize(""+t,"number"):d(t)?e.stylize(""+t,"boolean"):g(t)?e.stylize("null","null"):void 0}(e,r);if(o)return o;var s=Object.keys(r),a=function(e){var t={};return e.forEach((function(e,r){t[e]=!0})),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(r)),T(r)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return f(r);if(0===s.length){if(I(r)){var l=r.name?": "+r.name:"";return e.stylize("[Function"+l+"]","special")}if(w(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(A(r))return e.stylize(Date.prototype.toString.call(r),"date");if(T(r))return f(r)}var u,b="",S=!1,_=["{","}"];return h(r)&&(S=!0,_=["[","]"]),I(r)&&(b=" [Function"+(r.name?": "+r.name:"")+"]"),w(r)&&(b=" "+RegExp.prototype.toString.call(r)),A(r)&&(b=" "+Date.prototype.toUTCString.call(r)),T(r)&&(b=" "+f(r)),0!==s.length||S&&0!=r.length?n<0?w(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),u=S?function(e,t,r,n,i){for(var o=[],s=0,a=t.length;s<a;++s)x(t,String(s))?o.push(p(e,t,r,n,String(s),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(p(e,t,r,n,i,!0))})),o}(e,r,n,a,s):s.map((function(t){return p(e,r,n,a,t,S)})),e.seen.pop(),function(e,t,r){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}(u,b,_)):_[0]+b+_[1]}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,r,n,i,o){var s,a,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?a=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(a=e.stylize("[Setter]","special")),x(n,i)||(s="["+i+"]"),a||(e.seen.indexOf(l.value)<0?(a=g(r)?c(e,l.value,null):c(e,l.value,r-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+a.split("\n").map((function(e){return"   "+e})).join("\n")):a=e.stylize("[Circular]","special")),v(s)){if(o&&i.match(/^\d+$/))return a;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function h(e){return Array.isArray(e)}function d(e){return"boolean"==typeof e}function g(e){return null===e}function m(e){return"number"==typeof e}function y(e){return"string"==typeof e}function v(e){return void 0===e}function w(e){return b(e)&&"[object RegExp]"===S(e)}function b(e){return"object"==typeof e&&null!==e}function A(e){return b(e)&&"[object Date]"===S(e)}function T(e){return b(e)&&("[object Error]"===S(e)||e instanceof Error)}function I(e){return"function"==typeof e}function S(e){return Object.prototype.toString.call(e)}function _(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(v(o)&&(o=n.env.NODE_DEBUG||""),e=e.toUpperCase(),!s[e])if(new RegExp("\\b"+e+"\\b","i").test(o)){var r=n.pid;s[e]=function(){var n=t.format.apply(t,arguments);console.error("%s %d: %s",e,r,n)}}else s[e]=function(){};return s[e]},t.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=h,t.isBoolean=d,t.isNull=g,t.isNullOrUndefined=function(e){return null==e},t.isNumber=m,t.isString=y,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=v,t.isRegExp=w,t.isObject=b,t.isDate=A,t.isError=T,t.isFunction=I,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=r(384);var E=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function P(){var e=new Date,t=[_(e.getHours()),_(e.getMinutes()),_(e.getSeconds())].join(":");return[e.getDate(),E[e.getMonth()],t].join(" ")}function x(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",P(),t.format.apply(t,arguments))},t.inherits=r(496),t._extend=function(e,t){if(!t||!b(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}},351:()=>{},288:()=>{}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{"use strict";r.r(n),r.d(n,{FITSHeader:()=>c,FITSHeaderItem:()=>i,FITSParser:()=>y,FITSWriter:()=>l,ParseHeader:()=>f,ParsePayload:()=>u,ParseUtils:()=>o,default:()=>v});var e=r(351),t=r.n(e);class i{constructor(e,t,r){this._key=e,this._value=void 0!==t?t:void 0,this._comment=void 0!==r?r:void 0}get key(){return this._key}get comment(){return this._comment}get value(){return this._value}}class o{static getStringAt(e,t,r){let n=[];for(let i=t,o=0;i<t+r;i++,o++)n[o]=String.fromCharCode(255&e.charCodeAt(i));return n.join("")}static byteString(e){if(e<0||e>255||e%1!=0)throw new Error(e+" does not fit in a byte");return("000000000"+e.toString(2)).substr(-8)}static parse32bitSinglePrecisionFloatingPoint(e,t,r,n){let i=(((e<<8)+t<<8)+r<<8)+n;return i<0&&(i+=4294967296),(1+(8388607&i)/8388608)*Math.pow(2,((2139095040&i)>>23)-127)}static convertBlankToBytes(e,t){let r=Math.abs(e).toString(2);for(;r.length/8<t;)r+="0";let n=new ArrayBuffer(t),i=new Uint8Array(n);for(let e=0;e<t;e++)i[e]=parseInt(r.substr(8*e,8*(e+1)),2);return i}static parseFloatingPointFormat(e,t,r){for(var n=[],i=e.length;i;i-=1)for(var o=e[i-1],s=8;s;s-=1)n.push(o%2?1:0),o>>=1;n.reverse();var a=n.join(""),l=(1<<t-1)-1,u=parseInt(a.substring(0,1),2)?-1:1,c=parseInt(a.substring(1,1+t),2),f=parseInt(a.substring(1+t),2);return c===(1<<t)-1?0!==f?void 0:u*(1/0):c>0?u*Math.pow(2,c-l)*(1+f/Math.pow(2,r)):0!==f?u*Math.pow(2,-(l-1))*(f/Math.pow(2,r)):0*u}static generate16bit2sComplement(e){throw new TypeError("not implemented yet")}static parse16bit2sComplement(e,t){let r=e<<8|t;return 32768&r?4294901760|r:r}static parse32bit2sComplement(e,t,r,n){let i=e<<24|t<<16|r<<8|n,o=4294967295&i;return(2147483648&i)>>31?(o=1+(4294967295&~i),-1*o):o}static getByteAt(e,t){return 255&e.charCodeAt(t+0)}static extractPixelValue(e,t,r){let n;if(16==r)n=o.parse16bit2sComplement(t[e],t[e+1]);else if(32==r)n=o.parse32bit2sComplement(t[e],t[e+1],t[e+2],t[e+3]);else if(-32==r)n=o.parseFloatingPointFormat(t.slice(e,e+8),8,23);else{if(64==r)throw new Error("BITPIX=64 -> 64-bit 2's complement binary integer NOT supported yet.");-64==r&&(n=o.parseFloatingPointFormat(t.slice(e,e+8),11,52))}return n}}var s=r(520),a=r.n(s);class l{constructor(){}run(e,t){this.prepareHeader(e),this._payloadArray=t,this.prepareFITS()}prepareHeader(e){let t=new i("END",null,null);e.addItem(t);let r="";for(let t=0;t<e.getItemList().length;t++){let n=e.getItemList()[t];r+=this.formatHeaderLine(n.key,n.value,n.comment)}let n=(new TextEncoder).encode(r).length,s=2880*Math.ceil(n/2880);for(let e=0;e<s-n;e++)r+=" ";let a=new ArrayBuffer(r.length);this._headerArray=new Uint8Array(a);for(let e=0;e<r.length;e++)this._headerArray[e]=o.getByteAt(r,e)}formatHeaderLine(e,t,r){let n;if(null!=e){if(n=e,"END"==e){for(let t=80;t>e.length;t--)n+=" ";return n}if("COMMENT"==e||"HISTORY"==e){for(let t=0;t<10-e.length;t++)n+=" ";n+=t;let r=n.length;for(let e=80;e>r;e--)n+=" ";return n}for(let t=0;t<8-e.length;t++)n+=" ";if(n+="= ",null!=t){n+=t,null!=r&&(n+=r);let e=n.length;for(let t=80;t>e;t--)n+=" "}else{null!=r&&(n+=r);let e=n.length;for(let t=80;t>e;t--)n+=" "}}else{n="";for(let e=0;e<18;e++)n+=" ";if(null!=r){n+=r;let e=n.length;for(let t=80;t>e;t--)n+=" "}else{n="";for(let e=80;e>0;e--)n+=" "}}return n}prepareFITS(){let e=new Uint8Array(this._headerArray.length+this._payloadArray[0].length*this._payloadArray.length);e.set(this._headerArray,0);for(let t=0;t<this._payloadArray.length;t++){let r=this._payloadArray[t];e.set(r,this._headerArray.length+t*r.length)}this._fitsData=e}writeFITS(e){let r=a().dirname(e);t().mkdir(r,{recursive:!0},(e=>{if(e)throw e})),t().existsSync(r)?t().writeFileSync(e,this._fitsData):console.error(r+" doesn't exist")}typedArrayToURL(){let e=new Blob([this._fitsData],{type:"application/fits"});return URL.createObjectURL(e)}}class u{constructor(e,t){let r=t.slice(e.offset);this._u8data=new Uint8Array(r),this.init(e)}init(e){if(this._BZERO=e.get("BZERO"),void 0===this._BZERO&&(this._BZERO=0),this._BSCALE=e.get("BSCALE"),void 0===this._BSCALE&&(this._BSCALE=1),this._BLANK=e.get("BLANK"),this._BITPIX=e.get("BITPIX"),this._NAXIS1=e.get("NAXIS1"),this._NAXIS2=e.get("NAXIS2"),this._DATAMIN=e.get("DATAMIN"),this._DATAMAX=e.get("DATAMAX"),this._physicalblank=void 0,void 0===this._DATAMAX||void 0===this._DATAMIN){let[t,r]=this.computePhysicalMinAndMax();this._DATAMAX=r,this._DATAMIN=t;let n=new i("DATAMAX",r," / computed with FITSParser"),o=new i("DATAMIN",t," / computed with FITSParser");e.addItem(n),e.addItem(o)}}computePhysicalMinAndMax(){let e,t,r,n,i=0,o=Math.abs(this._BITPIX/8),s=this._u8data.byteLength/o;for(void 0!==this._BLANK&&(this._physicalblank=this.pixel2physicalValue(this._BLANK));i<s;)e=this.extractPixelValue(o*i),t=this.pixel2physicalValue(e),void 0!==this._physicalblank&&this._physicalblank===t||(void 0!==t&&(t<r||void 0===r)&&(r=t),void 0!==t&&(t>n||void 0===n)&&(n=t)),i++;return[r,n]}parse(){let e=Math.abs(this._BITPIX/8),t=this._u8data.byteLength/e;t=this._NAXIS1*this._NAXIS2;let r,n,i=0,o=[];for(;i<t;){n=Math.floor(i/this._NAXIS1),r=(i-n*this._NAXIS1)*e,0===r&&(o[n]=new Uint8Array(this._NAXIS1*e));for(let t=0;t<e;t++)o[n][r+t]=this._u8data[i*e+t];i++}return o}extractPixelValue(e){let t;if(16==this._BITPIX)t=o.parse16bit2sComplement(this._u8data[e],this._u8data[e+1]);else if(32==this._BITPIX)t=o.parse32bit2sComplement(this._u8data[e],this._u8data[e+1],this._u8data[e+2],this._u8data[e+3]);else if(-32==this._BITPIX)t=o.parseFloatingPointFormat(this._u8data.slice(e,e+4),8,23);else{if(64==this._BITPIX)throw new Error("BITPIX=64 -> 64-bit 2's complement binary integer NOT supported yet.");-64==this._BITPIX&&(t=o.parseFloatingPointFormat(this._u8data.slice(e,e+8),11,52))}return t}pixel2physicalValue(e){if(void 0!==e)return this._BZERO+this._BSCALE*e}}class c extends Map{constructor(){super(),this._items=[]}set offset(e){this._offset=e}get offset(){return this._offset}getItemList(){return this._items}getItemListOf(e){let t=[];for(let r=0;r<this._items.length;r++){let n=this._items[r];n.key==e&&t.push(n)}return t}addItemAtTheBeginning(e){["SIMPLE","BITPIX","NAXIS","NAXIS1","NAXIS2","BLANK","BZERO","BSCALE","DATAMIN","DATAMAX","NPIX","ORDER","CRPIX1","CRPIX2","CDELT1","CDELT2"].includes(e.key)&&this.set(e.key,e.value);let t=[e].concat(this._items);this._items=t}addItem(e){["SIMPLE","BITPIX","NAXIS","NAXIS1","NAXIS2","BLANK","BZERO","BSCALE","DATAMIN","DATAMAX","NPIX","ORDER","CRPIX1","CRPIX2","CDELT1","CDELT2"].includes(e.key)&&this.set(e.key,e.value),this._items.push(e)}getNumRows(){return this._items.length}}class f{static parse(e){let t,r,n,o,s,a,l,u,p=new TextDecoder("iso-8859-1"),h=new c,d=0,g="";for(;"END"!==g;){if(r=new Uint8Array(e.slice(80*d,80*d+80)),d++,n=new Uint8Array(r.slice(0,8)),g=p.decode(n).trim(),s=new Uint8Array(r.slice(8,10)),a=p.decode(s),o=new Uint8Array(r.slice(10,80)),t=p.decode(o).trim(),61==s[0]&&32==s[1]){let e=32;for(let t=0;t<o.length;t++)if(32!=o[t]){e=o[t];break}39==e?u=f.parseStringValue(o):84==e||70==e?u=f.parseLogicalValue(o):(t=p.decode(o).trim(),u=t.includes(".")?f.parseFloatValue(o):f.parseIntValue(o)),l=new i(g,u.val,u.comment)}else if("COMMENT"==g||"HISTORY"==g)l=new i(g,null,t);else{let e=32;for(let t=0;t<o.length;t++)if(32!=o[t]){e=o[t];break}47==e?l=new i(null,null,t):32==e&&(l=new i(null,null,null))}h.addItem(l)}l=new i("COMMENT","FITS generated with FITSParser on ",null),h.addItem(l);let m=new Date;l=new i("COMMENT",m.toString(),null),h.addItem(l);let y=2880*Math.ceil(d/36);return h.offset=y,h}static parseStringValue(e){let t=new TextDecoder("iso-8859-1").decode(e).trim(),r=t.lastIndexOf("/"),n=t.substring(0,r),i=t.substring(r);return void 0===i&&(i=null),{val:n,comment:i}}static parseLogicalValue(e){let t=new TextDecoder("iso-8859-1").decode(e).trim().split("/");return void 0===t[1]?{val:t[0].trim(),comment:null}:{val:t[0].trim(),comment:" /"+t[1]}}static parseIntValue(e){let t=new TextDecoder("iso-8859-1").decode(e).trim().split("/");return void 0===t[1]?{val:parseInt(t[0].trim()),comment:null}:{val:parseInt(t[0].trim()),comment:" /"+t[1]}}static parseFloatValue(e){let t=new TextDecoder("iso-8859-1").decode(e).trim().split("/");return void 0===t[1]?{val:parseFloat(t[0].trim()),comment:null}:{val:parseFloat(t[0].trim()),comment:" /"+t[1]}}}var p,h=r(288),d=r(300),g=r.n(d),m=function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}l((n=n.apply(e,t||[])).next())}))};class y{constructor(e){p.set(this,void 0),function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===n?i.call(e,r):i?i.value=r:t.set(e,r)}(this,p,e,"f")}loadFITS(){return m(this,void 0,void 0,(function*(){return this.getFile(function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}(this,p,"f")).then((e=>null!==e?this.processFits(e):null)).catch((e=>{var t,r;if(null===(r=null===(t=null==e?void 0:e.response)||void 0===t?void 0:t.data)||void 0===r?void 0:r.message)throw new Error("[FITSParser->loadFITS] "+e.response.data.message);throw e}))}))}processFits(e){let t=f.parse(e);return{header:t,data:new u(t,e).parse()}}static writeFITS(e,t,r){let n=new l;n.run(e,t),n.writeFITS(r)}getFile(e){return m(this,void 0,void 0,(function*(){return e.substring(0,5).toLowerCase().includes("http")?"undefined"!=typeof window?yield window.fetch(e,{method:"GET",mode:"cors",headers:{Accept:"image/fits","Content-Type":"image/fits","Access-Control-Allow-Origin":"*"}}).then((e=>{if(e.ok)return e.arrayBuffer();throw new Error("File not loaded. HTTP error: "+e.status+" "+e.statusText)})).catch((function(e){throw new Error("[FITSParser->getFile] "+e.response.data.message)})):yield g()(e,{method:"GET",headers:{Accept:"image/fits","Content-Type":"image/fits","Access-Control-Allow-Origin":"*"}}).then((e=>{if(e.ok)return e.arrayBuffer();if(404==e.status)return null;throw new Error("File not loaded. HTTP error: "+e.status+" "+e.statusText)})).catch((e=>{var t,r;if(null===(r=null===(t=null==e?void 0:e.response)||void 0===t?void 0:t.data)||void 0===r?void 0:r.message)throw new Error("[FITSParser->getFile] "+e.response.data.message);throw e})):yield(0,h.readFile)(e)}))}}p=new WeakMap;const v=FITSioAPI=function(e){return new y(e).loadFITS()}})(),FITSioAPI=n})();
//# sourceMappingURL=main.js.map